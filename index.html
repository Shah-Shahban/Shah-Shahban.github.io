<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PASSEE</title>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://cdn.jsdelivr.net/npm/nouislider/distribute/nouislider.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/nouislider/distribute/nouislider.min.js"></script>

  <style>
    /* --- SLIDER STYLING --- */
    
    /* 1. The Container/Track with DOTS */
    .noUi-target {
      height: 8px;
      border: none;
      box-shadow: none;
      border-radius: 9999px;
      margin: 15px 10px;
      cursor: pointer;

      /* Base Track Color */
      background-color: #e5e7eb; 

      /* THE DOTS: We create 4 small radial gradients (circles) */
      background-image: 
        radial-gradient(circle, #9ca3af 3px, transparent 3.5px), /* Dot 1 */
        radial-gradient(circle, #9ca3af 3px, transparent 3.5px), /* Dot 2 */
        radial-gradient(circle, #9ca3af 3px, transparent 3.5px), /* Dot 3 */
        radial-gradient(circle, #9ca3af 3px, transparent 3.5px); /* Dot 4 */
	
	  background-size: 8px 8px;

      /* Position the dots at 0%, 33%, 66%, and 100% width */
      background-position: 
        0% center, 
        33.333% center, 
        66.666% center, 
        100% center;
        
      background-repeat: no-repeat;
    }

    /* 2. The Filled Part (Colored Bar) */
    .noUi-connect {
      background: var(--thumb-color);
      border-radius: 9999px 0 0 9999px;
      /* The filled bar sits ON TOP of the background, so it covers the dots automatically */
    }

    /* 3. The Thumb (Handle) */
    .noUi-handle {
      width: 20px !important;
      height: 20px !important;
      border-radius: 50%;
      border: 2px solid white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
      background: var(--thumb-color);
      cursor: grab;
      top: -6px !important; 
      right: -10px !important; 
    }

    .noUi-handle:active { cursor: grabbing; transform: scale(1.1); }
    .noUi-handle::before, .noUi-handle::after { display: none; }
    .noUi-handle:focus { outline: none; }
  </style>
</head>
<body class="bg-gray-100 p-4">
  <h1 class="text-3xl font-bold text-center mb-4">PASSEE</h1>

  <div class="flex flex-col md:flex-row justify-center items-center gap-8 mb-16 mt-12 max-w-5xl mx-auto">
    <div class="w-full md:w-1/3 bg-white p-6 rounded-xl shadow-md">
        <h2 class="text-lg font-semibold mb-2 text-gray-700">The Gap</h2>
        <textarea 
            class="w-full h-40 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none text-sm text-gray-700"
            placeholder="Add your analysis notes here..."></textarea>
    </div>

    <div class="w-full md:w-1/4 flex justify-center">
      <canvas id="passeePie" width="250" height="250"></canvas>
    </div>
  </div>

  <div id="sliders" class="max-w-3xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-4 mt-8">
  </div>

  <script>
    const DIMENSIONS = [
      { key: "privacy", label: "Privacy", description: "Your data privacy objectives linked to your digital assests and stakeholders" },
      { key: "analytics", label: "Analytics", description: "Explainability of your model" },
      { key: "security", label: "Security", description: "Measures taken for digital and infrastructural security and safety" },
      { key: "society", label: "Society", description: "What is your social impact? i.e., social well-being, equity, inclusion etc." },
      { key: "economy", label: "Economy", description: "Business plan in financial terms" },
      { key: "environment", label: "Environment", description: "What is your ecological impact in terms of materials and energy?" }
    ];

    const COLORS = ["#6366f1", "#8b5cf6", "#ec4899", "#22c55e", "#eab308", "#0ea5e9", "#94a3b8"];
    const MAX_DEG = 60;

    let values = Object.fromEntries(DIMENSIONS.map(d => [d.key, 0]));

    function computePieData() {
      const slices = DIMENSIONS.map(d => (values[d.key] / 3) * MAX_DEG);
      const filled = slices.reduce((a,b)=>a+b,0);
      const gap = Math.max(0,360-filled);
      return [...slices,gap];
    }

    const ctx = document.getElementById('passeePie');
    let pieChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: [...DIMENSIONS.map(d=>d.label),"Gap"],
        datasets:[{data:computePieData(),backgroundColor:COLORS,borderColor:"#ffffff",borderWidth:2}]
      },
      options:{
        cutout:'70%',
        plugins:{
          tooltip:{callbacks:{label:ctx=>`${ctx.label}: ${ctx.raw.toFixed(0)}Â°`}},
          legend: { display: false }
        }
      }
    });

    function updateChart(){pieChart.data.datasets[0].data=computePieData();pieChart.update();}

    function createSliders(){
      const container=document.getElementById("sliders");container.innerHTML="";
      const groups=[{title:"Digital Dimensions",dims:DIMENSIONS.slice(0,3)},{title:"Sustainability Dimensions",dims:DIMENSIONS.slice(3)}];
      
      groups.forEach((group,gi)=>{
        const col=document.createElement("div");col.className="space-y-4";
        const header=document.createElement("h2");header.className="text-lg font-semibold text-center";header.innerText=group.title;col.appendChild(header);
        
        group.dims.forEach((dim,idx)=>{
          const dimColor = COLORS[idx+(gi*3)];
          const card=document.createElement("div");card.className="bg-white rounded-xl shadow p-3";
          
          const top=document.createElement("div");top.className="flex items-center justify-between mb-2";
          const left=document.createElement("div");left.className="flex items-center";
          const dot=document.createElement("span");dot.className="w-3 h-3 rounded-full mr-2";dot.style.backgroundColor=dimColor;
          const lbl=document.createElement("span");lbl.className="text-base font-medium";lbl.innerText=dim.label;
          left.appendChild(dot);left.appendChild(lbl);top.appendChild(left);
          
          const info=document.createElement("button");
          info.className="w-6 h-6 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 text-gray-600 text-sm font-bold transition-colors";
          info.innerText="i";
          
          const descBox = document.createElement("div");
          descBox.className = "hidden text-sm text-gray-600 bg-gray-50 p-2 rounded mb-3 border-l-4";
          descBox.style.borderColor = dimColor;
          descBox.innerText = dim.description;

          info.onclick = () => {
            if(descBox.classList.contains('hidden')) {
                descBox.classList.remove('hidden');
                info.style.backgroundColor = dimColor;
                info.style.color = '#ffffff';
            } else {
                descBox.classList.add('hidden');
                info.style.backgroundColor = '';
                info.style.color = '';
                info.className="w-6 h-6 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 text-gray-600 text-sm font-bold transition-colors";
            }
          };

          top.appendChild(info);
          card.appendChild(top);
          card.appendChild(descBox); 

          // --- SLIDER CREATION ---
          const sliderDiv = document.createElement("div");
          sliderDiv.style.setProperty('--thumb-color', dimColor);
          card.appendChild(sliderDiv);

          noUiSlider.create(sliderDiv, {
            start: [values[dim.key]], 
            connect: 'lower',
            range: {
              'min': 0,
              'max': 3
            },
            step: 1,
          });

          sliderDiv.noUiSlider.on('update', function (val) {
             values[dim.key] = parseInt(val[0]);
             updateChart();
          });
          
          const ticks=document.createElement("div");
          ticks.className="flex justify-between px-1 mx-1 mt-2 text-xs text-gray-500 font-mono";
          ["0","1","2","3"].forEach(t=>{
              const s=document.createElement("span");
              s.innerText=t;
              ticks.appendChild(s);
          });
          card.appendChild(ticks);
          
          col.appendChild(card);
        });
        container.appendChild(col);
      });
    }

    createSliders();
  </script>
</body>
</html>
